<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Upload</title>
    <style>
        /* Base layout */
        .container {
            max-width: 1200px;
            margin: 50px auto;
            padding: 0 20px;
        }

        /* Form components */
        .form {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
        }

        .form__group {
            margin-bottom: 20px;
        }

        .form__label {
            display: block;
            margin-bottom: 5px;
            color: #333;
        }

        .form__input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        /* Drop zone */
        .drop-zone {
            width: 100%;
            height: 200px;
            border: 2px dashed #ccc;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #fafafa;
        }

        .drop-zone:hover {
            border-color: #4CAF50;
            background: #f5f5f5;
        }

        .drop-zone--active {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }

        .drop-zone__text {
            margin: 8px 0;
            color: #666;
            text-align: center;
        }

        /* File list */
        .files {
            margin-top: 30px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 8px;
        }

        .files__list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .files__item {
            padding: 12px;
            border-bottom: 1px solid #eee;
            transition: background-color 0.2s;
        }

        .files__item:last-child {
            border-bottom: none;
        }

        .files__item:hover {
            background-color: #f5f5f5;
        }

        /* Utilities */
        .message {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }

        .message--error {
            background: #ffebee;
            color: #d32f2f;
        }

        .message--success {
            background: #e8f5e9;
            color: #2e7d32;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .drop-zone {
                height: 150px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Upload Video</h1>
        <form id="uploadForm" class="form" method="POST" action="/api/publish" enctype="multipart/form-data">
            <div class="form__group">
                <label for="title" class="form__label">Title:</label>
                <input type="text" id="title" class="form__input" required />
            </div>
            <div class="drop-zone" id="dropZone">
                <input type="file" class="drop-zone-input" id="file" accept="video/*" required />
                <p class="drop-zone__text">Drag and drop video file here</p>
                <p class="drop-zone__text">or click to select</p>
                <p id="selectedFileName" class="drop-zone__text"></p>
            </div>
            <button type="submit" id="submitBtn">Upload</button>
        </form>
        <p id="message" class="message"></p>

        <div class="files">
            <h2>Uploaded Files</h2>
            <button onclick="fetchFiles()">Refresh List</button>
            <ul id="filesList" class="files__list"></ul>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8080/api';
        const elements = {
            form: document.getElementById('uploadForm'),
            fileInput: document.getElementById('file'),
            titleInput: document.getElementById('title'),
            submitBtn: document.getElementById('submitBtn'),
            message: document.getElementById('message'),
            filesList: document.getElementById('filesList'),
            selectedFileName: document.getElementById('selectedFileName')
        };

        // async function fetchFiles() {
        //     try {
        //         elements.filesList.innerHTML = '<li>Loading...</li>';
        //         const response = await fetch(`${API_URL}/videos`);
        //         if (!response.ok) throw new Error('Failed to fetch files');
                
        //         const files = await response.json();
        //         elements.filesList.innerHTML = '';
                
        //         if (files.length === 0) {
        //             elements.filesList.innerHTML = '<li>No files uploaded yet</li>';
        //             return;
        //         }

        //         files.forEach(file => {
        //             const li = document.createElement('li');
        //             li.textContent = `Title: ${file.title} | File: ${file.uri}`;
        //             elements.filesList.appendChild(li);
        //         });
        //     } catch (error) {
        //         elements.filesList.innerHTML = '<li class="error">Error loading files</li>';
        //         console.error('Error:', error);
        //     }
        // }

        const dropZone = document.getElementById('dropZone');
    
        // Prevent default drag behaviors
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, preventDefaults, false);
            document.body.addEventListener(eventName, preventDefaults, false);
        });

        // Highlight drop zone when item is dragged over it
        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, unhighlight, false);
        });

        function preventDefaults (e) {
            e.preventDefault();
            e.stopPropagation();
        }

        function highlight(e) {
            dropZone.classList.add('drop-zone--active');
        }

        function unhighlight(e) {
            dropZone.classList.remove('drop-zone--active');
        }

        // Handle dropped files
        dropZone.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const file = dt.files[0];
            elements.fileInput.files = dt.files;
            updateFileName(file);
        }

        // Handle click to select file
        dropZone.addEventListener('click', () => {
            elements.fileInput.click();
        });

        elements.fileInput.addEventListener('change', event => {
            const file = event.target.files[0];
            updateFileName(file);
        });

        function updateFileName(file) {
            if (file) {
                elements.selectedFileName.textContent = file.name;
            } else {
                elements.selectedFileName.textContent = '';
            }
        }

        elements.form.addEventListener('submit', async event => {
            event.preventDefault();
            elements.submitBtn.disabled = true;
            elements.message.textContent = 'Uploading...';

            try {
                const formData = new FormData();
                formData.append('title', elements.titleInput.value.trim());
                formData.append('file', elements.fileInput.files[0]);

                const response = await fetch(`${API_URL}/publish`, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) throw new Error('Upload failed');

                const result = await response.json();
                elements.message.textContent = `Video uploaded successfully: ${result.uri}`;
                elements.form.reset();
                elements.selectedFileName.textContent = '';
                //fetchFiles();
            } catch (error) {
                elements.message.textContent = `Error: ${error.message}`;
                elements.message.classList.add('message--error');
            } finally {
                elements.submitBtn.disabled = false;
            }
        });

        // Initial load
        //fetchFiles();
    </script>
</body>
</html>
